# 🎓 Shader Graph의 Master Stack

## 🔷 Master Stack이란?

**Master Stack**은 Shader Graph에서 **최종 출력되는 셰이더의 핵심 구성 영역**.  
우리가 그래프로 만든 모든 노드의 결과값이 최종적으로 연결되어 **머티리얼 출력**에 반영.

즉, Master Stack은 셰이더에서 **빛, 색상, 질감 등 시각적 결과물을 결정짓는 마지막 단계**.

---

## 🧩 Master Stack의 구성

> 사용 중인 **렌더 파이프라인(URP/HDRP)**에 따라 구성은 다를 수 있지만,  
> 기본적으로 다음과 같은 공통 슬롯들을 포함:

| 슬롯 이름 | 설명 |
|-----------|------|
| **Base Color** | 머티리얼의 기본 색상. `Albedo Map`이나 컬러 값이 연결. |
| **Normal** | `Normal Map`을 연결하여 표면의 굴곡, 입체감을 시뮬레이션. |
| **Emission** | 자발광 효과. 어두운 환경에서도 자체적으로 빛나는 부분 표현에 사용. |
| **Metallic** | 표면의 금속성 비율 조절 (0 = 비금속, 1 = 완전 금속). |
| **Smoothness** | 표면의 반사 성질 조절 (0 = 거칠음, 1 = 매우 매끄러움). |
| **Alpha** | 투명도 조절 (0 = 완전 투명, 1 = 불투명). |
| **Alpha Clip Threshold** | 알파 값이 일정 기준 이하일 경우 해당 픽셀을 제거하는 기능 (Cutout). |
| **Specular** | (Specular Workflow 사용 시) 반사광의 강도와 색상을 제어하는 속성. |

---

## 🔍 용어 보충 설명

- **Albedo Map**: 조명 정보 없이 **표면의 순수한 색상**을 담은 텍스처.
- **Normal Map**: 실제 메시를 변경하지 않고 **빛의 반사 방향을 조작**하여 입체감을 표현하는 텍스처.

---
# 🎨 부위별 셰이더 효과 적용 및 마스크 전략

## ❓ 궁금한 점

### Q1. 각 부위에 다른 셰이더 효과를 적용하려면 텍스처 자체를 나눠서 만들어야 하는가?

✅ **그렇다.**  
셰이더에서 부위별로 다른 효과를 주고 싶다면, **미리 구분된 텍스처**를 사용하는 것이 일반적이다.

예를 들어, 캐릭터의 부위마다 다르게 셰이더 효과를 주고 싶다면 다음과 같이 **마스크 텍스처**를 설계한다:

| 채널 | 역할 예시 |
|------|-----------|
| Red  | 눈 (Eye) |
| Green | 옷 (Cloth) |
| Blue | 갑옷 (Armor) |
| Alpha | 발광 영역 (Emission) |

이처럼 **RGBA 채널을 활용하여 하나의 텍스처에 다양한 부위를 저장**하고,  
셰이더에서는 각 채널을 `Split` 노드 등으로 분리해서 사용함.

---

### Q2. 그런데 이미 텍스처가 그렇게 되어 있지 않다면 어떻게 해야 하는가?

### ✅ 해결 방법

#### ✨ 선택지 1: 마스크 텍스처 새로 제작
- **툴**: Photoshop, Substance Painter, Krita 등
- **방식**: 직접 그려서 RGBA 채널 또는 흑백으로 부위를 구분

#### ✨ 선택지 2: UV 분리 영역 활용
- UV가 잘 정리되어 있다면, **UV 좌표(x 또는 y)** 를 기준으로 분기 가능
- 예: `UV.x > 0.5` → 금속, 아니면 천
- Shader Graph에서 `Step`, `Compare` 노드 사용

#### ✨ 선택지 3: 셰이더 내부에서 범위 마스킹
- 텍스처 없이도 좌표값을 기반으로 조건 제어 가능
- 예: `Object Position.y` 또는 `World Position.y`를 기준으로 특정 높이 이상만 발광

```plaintext
World Position.y → Subtract → Step → Multiply → Emission Color
```
-> 머리 위쪽만 발광 효과를 주는 셰이더

## 🧠 결론 요약: 마스크 없이 셰이더 영역 제어하는 방법

> 이처럼 텍스처가 없어도 좌표를 활용해 **"가짜 마스크"** 를 만들 수 있습니다.

### ✅ 상황별 해결 방법 정리

| 상황 | 해결 방법 |
|------|-----------|
| 텍스처를 새로 만들 수 있다면 | **마스크 텍스처(RGBA 채널 분리)** 를 직접 제작하여 부위별 효과를 지정 |
| 기존 텍스처만 있고 수정이 어렵다면 | **UV 좌표 활용** 또는 **셰이더 내부에서 좌표 기반 마스킹** |
| 특정 부분만 효과를 주고 싶을 때 | `Step`, `Compare`, `Multiply` 등의 연산 노드를 조합해 범위 제어 가능 |

> 🎯 **셰이더는 텍스처와 함께 디자인되는 것이 가장 효율적**.

--- 

## 🧭 UV란 무엇인가?

### ✅ 정의

**UV**는 3D 모델의 표면에 **2D 텍스처를 입히기 위한 좌표계**입니다.  
모델의 각 정점(Vertex)에 대해 **U(가로), V(세로)** 좌표가 지정되며,  
이 UV 정보를 기반으로 텍스처가 정확하게 "펴지듯" 입혀집니다.

- U: 텍스처의 **X축 (가로 방향)**
- V: 텍스처의 **Y축 (세로 방향)**

> 📌 UV 좌표는 보통 0~1 범위의 값으로 구성되어 있음

---

## ✂️ UV 분리란?

UV 분리(또는 UV 세분화)는 **하나의 메시를 여러 영역으로 나누어 텍스처를 다르게 적용**하기 위한 기법입니다.

예:  
- 캐릭터의 **머리, 옷, 장갑, 신발** 등이 UV 상에서 **서로 다른 위치에 배치**됨
- 머리 = UV.x 0~0.25  
  옷 = UV.x 0.25~0.5  
  장갑 = UV.x 0.5~0.75  
  신발 = UV.x 0.75~1.0

---

## 🧭 UV란 무엇인가?

- **UV 좌표**는 3D 모델의 표면에 2D 텍스처를 입히기 위한 좌표 시스템.  
- 여기서 U는 텍스처의 **가로(X축)**, V는 **세로(Y축)** 방향을 의미.  
- 모델의 정점(Vertex)마다 이 UV 좌표가 정의되어 있으며,  
- 이 값에 따라 텍스처의 어떤 부분이 모델의 어떤 영역에 매핑될지가 결정.

- UV 좌표는 보통 0에서 1 사이의 값으로 구성.
- 예: (U: 0, V: 0) → 텍스처 왼쪽 아래 / (U: 1, V: 1) → 오른쪽 위
---

## ✂️ UV 분리란?

**UV 분리(UV 세분화)**는 3D 모델의 각 부위(머리, 옷, 신발 등)를  
UV 공간에서 **서로 다른 위치에 배치**하여, 하나의 텍스처 안에서 각 부위를 구분할 수 있게 만드는 작업.

- 예를 들어, 캐릭터의 머리는 텍스처의 왼쪽 위, 옷은 가운데, 신발은 오른쪽 아래에 배치될 수 있음.
- 이렇게 나누면, Shader Graph에서 **UV 좌표만으로 각 부위를 구분**할 수 있음.

---

## 🎯 Shader Graph에서 UV를 활용하는 방법

Shader Graph에서는 `UV` 정보를 가져와 조건을 나누는 방식으로  
**텍스처의 특정 영역에만 효과를 적용**할 수 있음.

### ✅ 예시 1: UV.x 기준으로 반쪽만 효과 적용

- UV.x가 0.5보다 큰 경우 → 오른쪽 영역
- 이를 기반으로 발광, 색상 변화 등을 줄 수 있음

### ✅ 예시 2: Compare 노드 또는 Step 노드와 조합

- UV.x > 0.3 → 특정 효과 적용
- UV.y < 0.2 → 하단만 마스킹 처리

---

## 🛠️ UV 분리는 어디서 하나?

- Blender, Maya, 3ds Max 같은 **3D 모델링 툴**에서 UV를 수동으로 분리하거나 펼칠 수 있음.
- UV Editor에서 모델의 각 부위를 **UV 공간에 적절히 배치**하면 됨.
- Unity에서는 UV 자체를 수정하진 않지만, Shader Graph에서 활용할 수 있음.

---

## 💡 요약

| 항목 | 설명 |
|------|------|
| UV란? | 3D 모델에 2D 텍스처를 입히는 좌표계 (U: 가로, V: 세로) |
| UV 분리 | 부위별로 텍스처 영역을 나누기 위해 UV를 분할 배치 |
| Shader Graph 활용 | UV.x, UV.y를 기준으로 조건 분기 → 부위별 셰이더 효과 적용 가능 |

---
## 🧮 Step 노드란?

### ✅ 정의

Step(edge, input)  
입력값 input이 기준값 edge보다 **크거나 같으면 1**,  
작으면 **0**을 출력하는 조건 분기 노드.

- 특정 조건을 만족하는 영역만 **활성화(1)**  
  그 외는 **비활성화(0)** 처리하여  
  마치 **흑백 마스크**처럼 활용.
```plaintext
if input >= edge:
    return 1
else:
    return 0
```

### 🎯 사용 예시
#### 1. 특정 범위 마스킹 (좌표 기반)
```plaintext
Object Position Y → Step(1.5) → Emission
```
→ 오브젝트의 높이가 1.5 이상인 부분만 빛남 (1.5 미만은 0 = 비활성)

#### 2. 텍스처 값이 일정 이상인 부분만 강조
```plaintext
Grayscale Texture → Step(0.5) → Multiply → Emission Color
```
→ 밝기가 0.5 이상인 부분만 Emission 효과 적용

---
## 🧪 Compare 노드란?

### ✅ 정의

**Compare 노드**는 두 입력 값(A, B)을 비교하여  
지정한 **조건(==, >, <, >= 등)** 에 따라 **True(1)** 또는 **False(0)** 값을 반환하는 Shader Graph 연산 노드.

- 조건 분기, 마스킹, UV 영역 구분 등에 활용.
- `Step`보다 더 다양한 비교 연산이 가능.

---

### ⚙️ 지원하는 비교 조건

| 조건     | 의미 |
|----------|------|
| Equal    | A == B |
| NotEqual | A ≠ B |
| Greater  | A > B |
| GreaterEqual | A ≥ B |
| Less     | A < B |
| LessEqual | A ≤ B |

---

### 🎯 사용 예시

#### 1. 특정 UV 범위에만 효과 적용

- UV.x > 0.5 인 경우에만 발광 효과
- UV → Split → Compare (Greater, 0.5) → Multiply → Emission Color

#### 2. 특정 좌표 영역만 마스킹
- Object Position.y < 1.2 인 부분만 표시
- Object Position.y → Compare (Less, 1.2) → Alpha Clip Threshold

### 🆚 Compare vs Step 차이

| 항목     | Step 노드                  | Compare 노드                         |
|----------|-----------------------------|--------------------------------------|
| 용도     | 기준값 이상인지 여부 판단      | 다양한 조건(>, <, == 등) 비교 가능   |
| 출력     | 0 또는 1                    | 0 또는 1                             |
| 장점     | 빠르고 단순함               | 더 복잡한 조건을 다룰 수 있음        |

## 💡 요약

- Compare 노드는 **두 값을 비교**해 결과를 0 또는 1로 반환
- `Step`보다 **비교 조건의 폭이 넓음**
- Shader Graph에서 **범위 조건, 마스크 처리, 좌표 비교** 등에 필수적으로 사용됨
---

## 🧾 마스터 스택에 필요한 기본 텍스처

| 번호 | 텍스처 이름              | 설명 |
|------|--------------------------|------|
| 1    | **Albedo Map**           | 표면의 기본 색상 (Base Color). 조명 영향을 받지 않는 순수한 색상 정보 |
| 2    | **Normal Map**           | 표면의 굴곡을 표현하여 입체감을 주는 텍스처 |
| 3    | **Metallic Map**         | 금속성과 비금속을 구분 (흰색 = 금속, 검정 = 비금속) |
| 4    | **Smoothness Map**       | 표면의 반사 퍼짐 정도 제어 (매끄러움 또는 거칠기 표현) |
| 5    | **Ambient Occlusion Map**| 접합 부위나 음영 부분을 어둡게 하여 입체감을 강조 |
| 6    | **Emission Map**         | 자발광 영역 정의. 어두운 환경에서도 빛나게 표현 가능 |


---

## ➕ 추가로 텍스처가 필요한 경우는 언제?

| 사용 목적                | 추가 텍스처                  | 설명 |
|--------------------------|-------------------------------|------|
| Detail 표현              | Detail Albedo / Detail Normal | 가까이서 볼 때 더욱 섬세한 질감 표현 |
| Transparency (Cutout)    | Opacity Map / Mask Map        | 알파 컷팅을 통한 투명한 영역 표현 |
| Anisotropy               | Anisotropy Map                | 헤어/브러시질 재질 등에서 방향성 반사 표현 |
| Specular Workflow        | Specular Map                  | Metallic 대신 반사광의 색상을 직접 지정 |
| Clear Coat 효과          | Coat Mask Map                 | 차량, 플라스틱처럼 겉에 코팅이 있는 표현 |
| Subsurface Scattering    | Thickness / SSS Map           | 피부, 밀랍처럼 빛이 내부로 퍼지는 재질 |
| Custom Shader Logic      | Mask, Noise, Flow 등          | 원하는 기능에 맞춰 사용자 정의용 텍스처 사용 |

---

## 📊 텍스처 사용 개수 기준

| 범주               | 사용되는 텍스처 개수 |
|--------------------|------------------------|
| 기본 PBR 구성       | 보통 **4 ~ 6개** |
| 고급 효과 포함 시   | **7개 이상** 가능 |
| 불필요한 경우 생략 가능 | 예: Emission이 없으면 **Emission Map 생략 가능** |

---

## 🧮 Shader Graph 연산 노드 정리

### 🔧 주요 연산 노드 및 활용

| 연산 노드 | 설명                    | 언제 쓰는가? |
|-----------|-------------------------|---------------|
| Multiply  | 곱셈 연산 (A × B)       | 강도 조절, 마스크 처리, 색상 × 밝기 등 |
| Add       | 덧셈 연산 (A + B)       | 빛 추가, Emission 밝기 증가, 값 누적 |
| Subtract  | 뺄셈 연산 (A - B)       | 반전, 차이 계산, 밝기 감소, 오프셋 제거 |

---

### 🎯 언제 어떤 연산을 써야 할까?

| 목적             | 추천 연산 노드 |
|------------------|----------------|
| 강도/세기 조절      | Multiply        |
| 효과 추가/누적      | Add             |
| 값 줄이기/반전      | Subtract        |
| 마스크 처리        | Multiply        |
| 좌표 오프셋        | Add, Subtract   |

---

### 📝 정리 한 줄 요약

- **Multiply**: "어디"에 "얼마나" 적용할지, **강도나 범위 조절**에 적합  
- **Add**: **빛 추가, 좌표 이동**, 다양한 효과 **누적 처리**에 적합  
- **Subtract**: **밝기 줄이기**, **방향 반전**, **차이 계산** 등에 적합

---


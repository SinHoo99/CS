# ğŸ® Unity ê³µë¶€ ê¸°ë¡ (2025-03-03)

## 1. ì˜¤ëŠ˜ì˜ í•™ìŠµ ëª©í‘œ ğŸ¯
- [ ] Unity ì¢…ë£Œ ì‹œ ë°œìƒí•˜ëŠ” `NullReferenceException` ë¬¸ì œ í•´ê²°
- [ ] `GameManager`ì™€ `SettingPopup` ê°„ì˜ ì˜ì¡´ì„± ìµœì†Œí™”
- [ ]  Unity ì¢…ë£Œ ìˆœì„œì— ë”°ë¥¸ `OnDisable()` ì˜ˆì™¸ ë°œìƒ ë°©ì§€

---

## 2. KPT íšŒê³  ğŸ“
âœ… Keep (ì˜í•œ ì )
- OnApplicationQuit()ì—ì„œ SettingPopupì„ ë¯¸ë¦¬ ë¹„í™œì„±í™”í•˜ì—¬ ì˜ˆì™¸ ë°œìƒ ê°€ëŠ¥ì„±ì„ ì›ì²œ ì°¨ë‹¨
- isQuitting í”Œë˜ê·¸ë¥¼ í™œìš©í•˜ì—¬ ê²Œì„ ì¢…ë£Œ ì¤‘ì—ëŠ” OnDisable()ì´ ì‹¤í–‰ë˜ì§€ ì•Šë„ë¡ ë°©ì–´ ì½”ë“œ ì¶”ê°€
- GameManager.Instanceë¥¼ ë¡œì»¬ ë³€ìˆ˜ë¡œ ì €ì¥í•˜ì—¬ ì°¸ì¡° ì•ˆì •ì„±ì„ ë†’ì„
- Try-Catchë¥¼ í™œìš©í•˜ì—¬ ì˜ˆìƒì¹˜ ëª»í•œ ì˜ˆì™¸ ë°œìƒ ì‹œ ë””ë²„ê¹… ë¡œê·¸ë¥¼ ì¶”ê°€í•¨

ğŸ”§ Problem (ì–´ë ¤ì› ë˜ ì )
- Unityì—ì„œ GameObjectì˜ ì‚­ì œ ìˆœì„œê°€ ë³´ì¥ë˜ì§€ ì•ŠìŒ  
  â†’ SettingPopup.OnDisable() ì‹¤í–‰ ì‹œì ì— GameManagerê°€ ì´ë¯¸ ì‚­ì œë  ê°€ëŠ¥ì„±ì´ ìˆì—ˆìŒ
- Application.isPlayingì„ ì²´í¬í–ˆìŒì—ë„ ë¶ˆêµ¬í•˜ê³  NullReferenceExceptionì´ ë°œìƒ
- GameManager.Instanceë¥¼ ì—¬ëŸ¬ ë²ˆ ì°¸ì¡°í•˜ëŠ” êµ¬ì¡° ë•Œë¬¸ì— ì¤‘ê°„ì— nullì´ ë  ê°€ëŠ¥ì„±ì´ ë†’ì•˜ìŒ

ğŸš€ Try (ê°œì„  ë°©ì•ˆ)
- GameManager.OnApplicationQuit()ì—ì„œ SettingPopup.gameObject.SetActive(false) ì‹¤í–‰  
    â†’ SettingPopup.OnDisable()ì´ ì‹¤í–‰ë˜ê¸° ì „ì— UIë¥¼ ë¹„í™œì„±í™”í•˜ì—¬ ì˜ˆì™¸ ë°©ì§€
- OnDisable() ë‚´ë¶€ì—ì„œ GameManager.Instanceë¥¼ ì§ì ‘ ì°¸ì¡°í•˜ì§€ ì•Šê³ , ë¡œì»¬ ë³€ìˆ˜ì— ì €ì¥ í›„ ì‚¬ìš©
- OnDisable() ì‹¤í–‰ ì „ì— Application.isPlayingê³¼ isQuittingì„ ì²´í¬í•˜ì—¬ ë¶ˆí•„ìš”í•œ ì‹¤í–‰ ë°©ì§€
- Debug.LogWarning()ì„ ì ê·¹ì ìœ¼ë¡œ í™œìš©í•˜ì—¬ ë””ë²„ê¹…ì— ìš©ì´í•˜ë„ë¡ ë¡œê·¸ë¥¼ ë‚¨ê¹€

---

## 3. í•™ìŠµí•œ ê°œë… ğŸ“

### ğŸ”¹ Unity ì¢…ë£Œ ìˆœì„œì™€ NullReferenceException ë°œìƒ ì›ì¸
- Unityì˜ OnDisable() ì‹¤í–‰ ìˆœì„œëŠ” ë³´ì¥ë˜ì§€ ì•ŠìŒ
- Play Mode ì¢…ë£Œ ì‹œ ì–´ë–¤ ì˜¤ë¸Œì íŠ¸ê°€ ë¨¼ì € ì‚­ì œë ì§€ ì˜ˆì¸¡í•  ìˆ˜ ì—†ìŒ
- íŠ¹ì • GameObjectê°€ ë¨¼ì € ì‚­ì œë˜ë©´ Instance ì°¸ì¡° ì‹œ NullReferenceException ë°œìƒ ê°€ëŠ¥

ğŸ”¹ OnApplicationQuit()ì—ì„œ UIë¥¼ ë¯¸ë¦¬ ë¹„í™œì„±í™”í•˜ëŠ” ë°©ë²•
```csharp
private void OnApplicationQuit()
{
    isQuitting = true;

    // âœ… SettingPopupì„ ë¨¼ì € ë¹„í™œì„±í™”í•˜ì—¬ OnDisable() ì‹¤í–‰ ë°©ì§€
    if (UIManager != null && UIManager.SettingPopup != null)
    {
        Debug.Log("âš ï¸ GameManager: ê²Œì„ ì¢…ë£Œ ì¤‘, SettingPopupì„ ë¯¸ë¦¬ ë¹„í™œì„±í™”í•©ë‹ˆë‹¤.");
        UIManager.SettingPopup.gameObject.SetActive(false);
    }

    _playerDataManager.SavePlayerData();
    _prefabDataManager.SavePrefabData();
    _bossDataManager.SaveBossRuntimeData();
}

```
âœ… ì´ì œ SettingPopupì´ í™œì„±í™”ëœ ìƒíƒœì—ì„œ ê²Œì„ì´ ì¢…ë£Œë˜ì–´ë„ OnDisable()ì´ ì‹¤í–‰ë˜ì§€ ì•Šì•„ NullReferenceExceptionì´ ë°œìƒí•˜ì§€ ì•ŠìŒ!

ğŸ”¹ OnDisable()ì—ì„œ GameManager ì•ˆì „í•˜ê²Œ ì°¸ì¡°í•˜ëŠ” ë°©ë²•
```csharp
private void OnDisable()
{
    if (GameManager.Instance == null || GameManager.Instance.isQuitting)
    {
        Debug.LogWarning("âš ï¸ SettingPopup: ê²Œì„ì´ ì¢…ë£Œ ì¤‘ì´ë¯€ë¡œ OnDisable() ì‹¤í–‰í•˜ì§€ ì•ŠìŒ.");
        return;
    }

    if (GameManager.Instance.GetAudioMixer() == null)
    {
        Debug.LogWarning("âš ï¸ SettingPopup: AudioMixerê°€ ì•„ì§ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìœ¼ë¯€ë¡œ OnDisable() ì‹¤í–‰í•˜ì§€ ì•ŠìŒ.");
        return;
    }

    AudioMixer.GetFloat(Mixer.BGM, out float BGMVolume);
    GameManager.Instance.SoundManager.NowOptionData.BGMVolume = BGMVolume;

    AudioMixer.GetFloat(Mixer.SFX, out float SFXVolume);
    GameManager.Instance.SoundManager.NowOptionData.SFXVolume = SFXVolume;

    GameManager.Instance.SoundManager.SaveOptionData();
}

```
âœ… ì´ì œ GameManager.Instanceê°€ ì‚­ì œëœ ê²½ìš°ì—ë„ OnDisable() ì‹¤í–‰ì„ ì•ˆì „í•˜ê²Œ ì¤‘ë‹¨!
## 4. C# ì½”ë“œ ì˜ˆì œ ğŸ’»
```csharp
using UnityEngine;

public class SafeGameExit : MonoBehaviour
{
    private void OnApplicationQuit()
    {
        Debug.Log("ğŸšª ê²Œì„ ì¢…ë£Œ ì¤‘...");
        
        if (UIManager.Instance != null && UIManager.Instance.SettingPopup != null)
        {
            UIManager.Instance.SettingPopup.gameObject.SetActive(false);
            Debug.Log("âš ï¸ SettingPopupì„ ë¯¸ë¦¬ ë¹„í™œì„±í™”í•˜ì—¬ ì˜ˆì™¸ ë°©ì§€");
        }
    }
}
```
âœ… ì´ì œ Unity ì¢…ë£Œ ì‹œ SettingPopupì„ ì•ˆì „í•˜ê²Œ ë¹„í™œì„±í™”í•˜ì—¬ NullReferenceExceptionì„ ì™„ì „íˆ ë°©ì§€í•  ìˆ˜ ìˆìŒ! ğŸš€ğŸ”¥

## 5. ì˜¤ëŠ˜ì˜ íšŒê³  ğŸ“Œ

- Unityì˜ ì˜¤ë¸Œì íŠ¸ ì‚­ì œ ìˆœì„œëŠ” ì˜ˆì¸¡í•  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ ë°©ì–´ ì½”ë“œê°€ í•„ìš”í•˜ë‹¤.
- OnApplicationQuit()ì—ì„œ ë¯¸ë¦¬ í•„ìš”í•œ UIë¥¼ ë¹„í™œì„±í™”í•˜ëŠ” ê²ƒì´ ê°€ì¥ í™•ì‹¤í•œ ë°©ë²•ì´ë‹¤.
- GameManager.Instanceë¥¼ ì—¬ëŸ¬ ë²ˆ ì°¸ì¡°í•˜ì§€ ì•Šê³  ë¡œì»¬ ë³€ìˆ˜ë¡œ ì €ì¥ í›„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì•ˆì •ì ì´ë‹¤.
- Unity ì¢…ë£Œ ì‹œ ë°œìƒí•˜ëŠ” ë¬¸ì œë¥¼ ë°©ì–´í•  ìˆ˜ ìˆëŠ” íŒ¨í„´ì„ ìµí˜€ì„œ, ë‹¤ë¥¸ UIì—ë„ ì ìš©í•  ìˆ˜ ìˆë‹¤!

ğŸ¯ ë‹¤ìŒ ëª©í‘œ:
- OnApplicationQuit()ì—ì„œ ì—¬ëŸ¬ UIë¥¼ ì•ˆì „í•˜ê²Œ ì¢…ë£Œí•˜ëŠ” í†µí•©ì ì¸ UI ê´€ë¦¬ ì‹œìŠ¤í…œì„ ë§Œë“¤ì–´ë³´ê¸°
- Unityì˜ DontDestroyOnLoad()ì™€ Scene ì „í™˜ì—ì„œ OnDisable()ì´ ì–´ë–»ê²Œ ë™ì‘í•˜ëŠ”ì§€ ë” ê¹Šì´ ê³µë¶€í•˜ê¸°
